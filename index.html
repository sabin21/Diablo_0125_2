<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Diablo Immortal</title>
    <link  rel="stylesheet" href="./styles/index.css">
</head>
<body>

    <header class="header-left-wrap">
        <div class="logo-wrap">
            <img src="./img/header_logo_temp.png">
        </div>
        <div class="download-wrap">
            <img src="./img/header_btn_temp.png">
        </div>
    </header>
    <div class="links-wrap">
        <a class="btn">
            <span class="icon"></span>
            <span class="btn-text">디아블로 이모탈 공식 사이트</span>
        </a>
    </div>
    <div class="trailer-link-wrap">
        <a class="btn">
            <span class="icon">
                <img src="./img/icon_youtube.svg">
            </span>
            <span class="btn-text">고해상도 영상보기</span>
        </a>
    </div>

    <div class="hero-section" id="container"></div>
    
    <span class="hero-cover"></span>
    
    <div class="hero-wrap">
        <div class="big-logo-wrap">
            <img src="./img/immortal_logo_basic.png">
        </div>
        <div class="headline-wrap">
            <img src="./img/headline_copy.png" id="headline-copy">
        </div>
        <img src="./img/onestore_icon.png" id="onestore-icon">
    </div>
    <span class="bottom-gradient"></span>

    <div class="group-wrap">
        <article class="interview interview-1">
            <div class="interview-wrap">
                <video loop muted autoplay crossOrigin="anonymous">
                    <source src="./video/boss_mad_loop.mp4" type='video/mp4;'>
                </video>
                <div class="interview-inner">
                    <div class="description left">
                        <h3 class="headline">
                            광란과 파괴의 군주,<br> 해골왕이 돌아오다.
                        </h3>
                        <p>
                            한때는 성군 레오릭 왕으로 불렸던 해골 왕은 디아블로 이모탈에서도 필멸자들을 맞이한다. 
                            (여러 의미에서) 절대 죽지 않는 언데드인 그를 <미친 왕의 틈>에서 만났다.   
                            새로운 전투를 준비하는 그의 잔혹함은, 너무 오래 전에 뻥 뚫려 공허함마저 
                            느껴지지 않는 차디찬 얼굴에서부터 느낄 수 있었다.
                            <br><br>
                            한때는 성군 레오릭 왕으로 불렸던 해골 왕은 디아블로 이모탈에서도 필멸자들을 맞이한다. 
                            (여러 의미에서) 절대 죽지 않는 언데드인 그를 <미친 왕의 틈>에서 만났다.   
                            새로운 전투를 준비하는 그의 잔혹함은, 너무 오래 전에 뻥 뚫려 공허함마저 느껴지지 않는 
                            차디찬 얼굴에서부터 느낄 수 있었다.
                        </p>
                    </div>
                </div>
            </div>
        </article>
        <article class="interview interview-2">
            <div class="interview-wrap">
                <video loop muted autoplay crossOrigin="anonymous">
                    <source src="./video/boss_baal_loop.mp4" type='video/mp4;'>
                </video>
                <div class="interview-inner">
                    <div class="description right">
                        <h3 class="headline">
                            교활하고 사악한 본성,<br>바알을 마주하다.
                        </h3>
                        <p>
                            한때는 성군 레오릭 왕으로 불렸던 해골 왕은 디아블로 이모탈에서도 필멸자들을 맞이한다. 
                            (여러 의미에서) 절대 죽지 않는 언데드인 그를 <미친 왕의 틈>에서 만났다.   
                            새로운 전투를 준비하는 그의 잔혹함은, 너무 오래 전에 뻥 뚫려 공허함마저 
                            느껴지지 않는 차디찬 얼굴에서부터 느낄 수 있었다.
                            <br><br>
                            한때는 성군 레오릭 왕으로 불렸던 해골 왕은 디아블로 이모탈에서도 필멸자들을 맞이한다. 
                            (여러 의미에서) 절대 죽지 않는 언데드인 그를 <미친 왕의 틈>에서 만났다.   
                            새로운 전투를 준비하는 그의 잔혹함은, 너무 오래 전에 뻥 뚫려 공허함마저 느껴지지 않는 
                            차디찬 얼굴에서부터 느낄 수 있었다.
                        </p>
                    </div>
                </div>
            </div>
        </article>
        <article class="interview interview-3">
            <div class="interview-wrap">
                <video loop muted autoplay crossOrigin="anonymous">
                    <source src="./video/boss_countess_loop.mp4" type='video/mp4;'>
                </video>
                <div class="interview-inner">
                    <div class="description left">
                        <h3 class="headline">
                            피로 물든 아름다움,<br>잊힌탑의 백작
                        </h3>
                        <p>
                            한때는 성군 레오릭 왕으로 불렸던 해골 왕은 디아블로 이모탈에서도 필멸자들을 맞이한다. 
                            (여러 의미에서) 절대 죽지 않는 언데드인 그를 <미친 왕의 틈>에서 만났다.   
                            새로운 전투를 준비하는 그의 잔혹함은, 너무 오래 전에 뻥 뚫려 공허함마저 
                            느껴지지 않는 차디찬 얼굴에서부터 느낄 수 있었다.
                            <br><br>
                            한때는 성군 레오릭 왕으로 불렸던 해골 왕은 디아블로 이모탈에서도 필멸자들을 맞이한다. 
                            (여러 의미에서) 절대 죽지 않는 언데드인 그를 <미친 왕의 틈>에서 만났다.   
                            새로운 전투를 준비하는 그의 잔혹함은, 너무 오래 전에 뻥 뚫려 공허함마저 느껴지지 않는 
                            차디찬 얼굴에서부터 느낄 수 있었다.
                        </p>
                    </div>
                </div>
            </div>
        </article>
        <div class="con-wrap">
            <section class="section-tip" id="section-tip">
                <div class="tip-wrap">
                    <img src="./img/tip_temp.png" class="temp-img">
                </div>
            </section>

            <section class="section-channel">
                <div class="channel-wrap inner-left-margin">
                    <img src="./img/channel_temp.png">
                </div>
            </section>

            <section class="section-event">
                <div class="event-back-wrap">                    
                    <span class="pict-card" id="stage-city">
                        <img src="./img/stage_city.jpg">
                    </span>
                    <span class="pict-card" id="mon-hidra">
                        <img src="./img/mon_hidra.jpg">
                    </span>
                    <span class="pict-card" id="mon-spider">
                        <img src="./img/mon_spider.jpg">
                    </span>                    
                    <span class="pict-card" id="mon-skull">
                        <img src="./img/mon_skull.jpg">
                    </span>
                    <span class="pict-card" id="mon-skull-blue">
                        <img src="./img/mon_skull_blue.jpg">
                    </span>    
                </div>
                <div class="event-con-wrap">
                    <div class="inner-wrap">
                        <div class="card-wrap">
                            <img src="./img/event_temp_1.png">
                            <img src="./img/event_temp_2.png">
                        </div>
                    </div>
                </div>
            </section>
        </div>

    </div>
    <!--  -->
    
    <video id="video" loop muted autoplay crossOrigin="anonymous" style="display:none;">
        <source src="./video/play_preview.mp4" type='video/mp4;'>
    </video>

    <video id="video-trailer" loop muted paused crossOrigin="anonymous" style="display:none;">
        <source src="./video/trailer_old.mp4" type='video/mp4;'>
    </video>

    <span class="trigger-wrap">
        <span class="trigger trigger-1"></span>
        <span class="trigger trigger-2"></span>
        <span class="trigger trigger-3"></span>
        <span class="trigger trigger-4"></span>
        <span class="trigger trigger-5"></span>
    </span>

    <script src="./js/gsap.min.js"></script>
    <script src="./js/ScrollTrigger.min.js"></script>
    
    <script type="module">
        import * as THREE from './js/three/build/three.module.js';
        import { GLTFLoader } from './js/three/examples/jsm/loaders/GLTFLoader.js';
        import { Reflector } from './js/three/examples/jsm/objects/Reflector.js';

        let container;
        let camera, scene, renderer, light, light2;
        let video, videoTexture, videoMat, phoneBodyMat, iconRig, trailerTexture, trailerVideo, trailerMat, groundMirror;
        let bg1Material, oneStoreMat;
        const trailerRig = new THREE.Object3D();
        const oneStoreRig = new THREE.Object3D();
        const tipWidth = document.querySelector('.tip-wrap').offsetWidth;

        init();
        function init() {
            container = document.getElementById('container');
            renderer = new THREE.WebGLRenderer({antialias: true});
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.setAnimationLoop( animation );
            renderer.setClearColor(0x000000);
            container.appendChild( renderer.domElement );

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.01, 1000);
            camera.position.set( 0, 0, 5 );
            
            scene = new THREE.Scene();
            
            light = new THREE.PointLight( 0xffffff, 2, 1000 );
            light.position.set(2 ,8 ,10);
            light2 = new THREE.DirectionalLight(0xffffff, 6);

            scene.add(light);
            scene.add(light2);

            // Background
            let ang_rad = camera.fov * Math.PI / 180;
            let fov_y = (camera.position.z + 10) * Math.tan(ang_rad / 2) * 2;	
            const textureLoader = new THREE.TextureLoader();
            const bg1Texture = textureLoader.load('./textures/back_city.jpg');
            const bg1Geometry = new THREE.PlaneGeometry(16*1.4, 9*1.4);
            bg1Material = new THREE.MeshBasicMaterial({ 
                map: bg1Texture,
                transparent:true,
                opacity:0.0
            });

            const bg1Mesh = new THREE.Mesh(bg1Geometry, bg1Material);
            bg1Mesh.scale.set(3.8, 3.8, 1);		
            bg1Mesh.position.set(0, 0.3, -50);
            scene.add(bg1Mesh);

            // Floor
            const floorMirrorGeo = new THREE.PlaneGeometry( 400, 400 );
            groundMirror = new Reflector( floorMirrorGeo, {
                clipBias: 0.003,
                textureWidth: window.innerWidth * window.devicePixelRatio,
                textureHeight: window.innerHeight * window.devicePixelRatio,
                color: 0x333333
            });	
            groundMirror.position.y = -1.0;
            groundMirror.rotateX( - Math.PI / 2 );
            scene.add(groundMirror);

            // Icon Mesh
            iconRig = new THREE.Object3D();
            const loader = new GLTFLoader();

            loader.load( './models/logo_icon.glb', function ( gltf ) {
                const iconScene = gltf.scene;
                iconRig.add(iconScene);
            });

            iconRig.position.set(0, -3, 0);
            iconRig.rotation.set(0, 4, 0);
            scene.add(iconRig);

            // Phone Mesh
            let phoneRig = new THREE.Object3D();
            const loaderPhone = new GLTFLoader();
            const loaderPhoneScreen = new GLTFLoader(); 
            let phoneBodyMesh = null;
            let phoneScreenMesh = null;
            let phoneBodyGeo = null;
            
            loaderPhone.load ('./models/phone_2_body.glb', (gltf) => {
                const stoneMesh = gltf.scene.children.find((mesh) => mesh.name === "phone_body");
                phoneBodyGeo = stoneMesh.geometry.clone();
                phoneBodyMat = new THREE.MeshPhysicalMaterial({
                        color : 0x0E0E0E,
                        metalness: 0.5,
                        roughness: 0.5,
                        transmission: 1,
                        reflectivity: 0.5,
                        thickness: 2.5
                    });
                phoneBodyMesh = new THREE.Mesh(phoneBodyGeo, phoneBodyMat);				
                phoneRig.add(phoneBodyMesh);
            });
            
            loaderPhoneScreen.load ('./models/phone_2_screen.glb', (gltf) => {
                const stoneMesh = gltf.scene.children.find((mesh) => mesh.name === "phone_screen");
                const phoneScreenGeometry = stoneMesh.geometry.clone();
                phoneScreenMesh = new THREE.Mesh(phoneScreenGeometry, videoMat);			
                phoneRig.add(phoneScreenMesh);
            });
            phoneRig.position.set(0.8, -10, -3 );
            phoneRig.rotation.set(0, Math.PI*2, 0 );
            scene.add(phoneRig);

            // video textures - phone screen
            video = document.getElementById( 'video' );
            video.play();
            videoTexture = new THREE.VideoTexture( video, function(video){
                video.wrapS = texture.wrapT = THREE.RepeatWrapping;
                video.offset.set( 0, 0 );
                video.repeat.set(2,2);
            });
            videoMat = new THREE.MeshLambertMaterial({ 
                color:0xffffff, 
                map: videoTexture
            });

            //------------------
            // Trailer Screen

            const loaderTrailerScreen = new GLTFLoader();

            trailerVideo = document.getElementById( 'video-trailer' );

            trailerTexture = new THREE.VideoTexture( trailerVideo, function(trailerVideo){
                trailerVideo.wrapS = texture.wrapT = THREE.RepeatWrapping;
                trailerVideo.offset.set( 0, 0 );
                trailerVideo.repeat.set(2,2);
            })

            const trailerRoughnessTexture = textureLoader.load('./img/SurfaceImperfections003_1K_var1.jpg');
            const trailerNormalTexture = textureLoader.load('./img/SurfaceImperfections003_1K_Normal.jpg');

            trailerMat = new THREE.MeshPhysicalMaterial({ 
                color:0xffffff, 
                map: trailerTexture,
                roughnessMap: trailerRoughnessTexture,
                normalMap: trailerNormalTexture,
                reflectivity: 0,
                metalness:0.1,
                roughness:1,
                transparent:true,
                opacity:1
            });

            const trailerScreenGeo = new THREE.PlaneGeometry(16, 9);
            const trainerScreenMesh = new THREE.Mesh(trailerScreenGeo, trailerMat);
            trailerRig.add(trainerScreenMesh);
            trailerRig.position.set(1.2, -8, -50);				
            scene.add(trailerRig);

            //---------------------------
            window.addEventListener( 'resize', onWindowResize );

            //---------------------------
            // Intro - ScrollTrigger

            function trailerPlay(){
                trailerVideo.play();
            }
            function trailerPause(){
                trailerVideo.pause();
            }
            let introTL = new gsap.timeline();
            introTL
            .add('start')
            .to(bg1Material, { opacity: 1, duration:1 })
            .to('.big-logo-wrap', { opacity: 1 , duration: 0.6}, 'start')
            .to(iconRig.position, { y: -0.2 , duration: 4, onComplete: trailerPlay}, 'start')
            .to(iconRig.rotation, { y: 0 , duration: 5}, 'start')
            .delay(1.5).add('middle')
            .to('.big-logo-wrap', { opacity: 0 , duration: 0.4}, 'middle')
            .to(iconRig.position, { z: 6, duration: 0.6}, 'middle')
            .to(iconRig.position, { y: 0, duration: 0.6}, 'middle')
            .to('.header-left-wrap', { left: 0, duration: 0.4})
            .to(groundMirror.position, { y: -4, duration:0.6}, 'middle')
            .to(bg1Material, { opacity: 0.7, duration:1 }, 'middle')		
            .to(trailerRig.position, { y: 0, z:-10, duration:0.6}, 'middle')
            //.to(trailerRig.rotation, { y: -Math.PI/32, duration:0.6}, 'middle')
            .to(light.position, { x: 13, duration: 1, onComplete: scene1Trigger}, 'middle')
            .to('.trailer-link-wrap', { opacity:1, duration:0.4});

            gsap.registerPlugin(ScrollTrigger);
            let scene1TL = gsap.timeline();
            let scene2TL = gsap.timeline();
            
            function scene1Trigger(){
                scene1TL
                .add('scene1Start')		
                .to(trailerRig.position, { x: 26, y:2.5, z:-44}, 'scene1Start')
                .to(trailerRig.rotation, { y: -Math.PI/2.6 }, 'scene1Start')
                .to(trailerMat, { opacity: 0.4}, 'scene1Start')
                .to('.trailer-link-wrap', { opacity:0, duration:0.2}, 'scene1Start')
                .to(phoneRig.rotation, { y: 0 }, 'scene1Start')
                .to(phoneRig.position, { y: 0 }, 'scene1Start')
                .to(groundMirror.position, { y: -1.3}, 'scene1Start')
                .add('middle')
                .to('.headline-wrap', { bottom: 260})
                .to('#onestore-icon', { bottom: 540}, 'middle');
                ScrollTrigger.create({
                    animation: scene1TL,
                    trigger: ".trigger-1",
                    start: "top top",
                    end : "bottom 100%",
                    scrub: true
                });
            }

            scene2TL.to('.hero-cover', { opacity: 1});
            ScrollTrigger.create({
                animation: scene2TL,
                trigger: ".trigger-2",
                start: "top 50%",
                end : "top 5%",
                scrub: true
            });
            
            gsap.to(".tip-wrap", {
                scrollTrigger: {
                    scrub: true,
                    trigger: "#section-tip",
                    pin: "#section-tip",
                    start: "top top",
                    end: tipWidth + 'px'
                }, 
                x: -tipWidth,
                ease: "none"
            });


        } //!------ end init

        function onWindowResize() {

            const width = window.innerWidth;
            const height = window.innerHeight;

            camera.aspect = width / height;
            camera.updateProjectionMatrix();

            renderer.setSize( width, height );

        }

        function animation() {
            camera.lookAt( 0,0,0 );
            render();	
        };

        function render() {	
            renderer.render( scene, camera );
        }

        //---------------

        const interviewTriggers = document.querySelectorAll('.interview');
        interviewTriggers.forEach(addTimeline);

        function addTimeline(interview, i){
            const interviewCon = interview.querySelector('.interview-wrap');
            const timeline = gsap.timeline({
                scrollTrigger: {
                trigger: interview,
                start: "center bottom",
                ease: "power2",
                toggleActions: "play none none reverse"
                }
            })
            .to(interviewCon, { scale: 1, duration: 0.4, stagger: 0.2 }, "-=0.5");
        }

        const eventTL = new gsap.timeline();

        eventTL
        .add('start')
        .to('#mon-skull-blue', { bottom: '100%', duration: 10, repeat:-1})
        .to('#stage-city', { bottom: '100%', duration: 12, repeat:-1},'start')
        .to('#mon-spider', { bottom: '120%', duration: 14, repeat:-1},'start')
        .to('#mon-skull', { bottom: '100%', duration: 14, repeat:-1},'start')
        .to('#mon-hidra', { bottom: '100%', duration: 18, repeat:-1},'start');
    </script>

</body>
</html>